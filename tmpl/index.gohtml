<!DOCTYPE html>
<html>
<head>
<title>OSD</title>
<style type="text/css">
/* Javascript below assumes the placement of this stylesheet, and the order of these rules */
body { font-family: '{{.Settings.Font}}'; line-height: {{.Settings.LineHeight}}%; font-size: {{.Settings.FontSize}}px; background-color: {{.Settings.BackgroundColor}}; margin: 0; padding: 0; } 
.volts { color: {{.Settings.VoltColor}}; }
.amps { color: {{.Settings.AmpColor}}; }
.error .volts, .error .amps { color: {{.Settings.BackgroundColor}}; }
</style>
<style type="text/css">
#psu { width: 5em; }
.volts, .amps { text-align: right; transition: color .5s; }
.volts:after { content: "V"; }
.amps:after { content: "A"; }
</style>
<script>
document.addEventListener("DOMContentLoaded", function(e) {
	let source = new EventSource({{.EventSource}});
	let psu = document.getElementById("psu")
	let volts = psu.querySelector(".volts")
	let amps = psu.querySelector(".amps")

	source.addEventListener("settings", (e) => {
		let s = new URLSearchParams(e.data)
		let cr = document.styleSheets[0].cssRules
		cr[0].style.backgroundColor = s.get("backgroundColor")
		cr[0].style.fontFamily = "'" + s.get("font") + "'"
		cr[0].style.fontSize = s.get("fontSize") + "px"
		cr[0].style.fontWeight = s.get("fontWeight")
		cr[0].style.lineHeight = s.get("lineHeight") + "%"
		cr[1].style.color = s.get("voltColor")
		cr[2].style.color = s.get("ampColor")
		cr[3].style.color = s.get("backgroundColor")
	})
	source.addEventListener("error", (e) => psu.classList.add("error"))
	source.addEventListener("open", (e) => psu.classList.remove("error"))
	source.addEventListener("volts", (e) => volts.innerText = e.data);
	source.addEventListener("amps", (e) => amps.innerText = e.data);
});
</script>
</head>
<body>
	<div id="psu" class="error">
		<div class="volts" title="Volts"></div>
		<div class="amps" title="Amps"></div>
	</div>
</body>
</html>